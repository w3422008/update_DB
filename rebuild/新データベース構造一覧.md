# 病院システム データベース構造一覧（リビルド版）

## データベース概要

- **データベース名**: hosplistdb_v2
- **文字コード**: utf8mb4
- **エンジン**: InnoDB
- **用途**: 病院・医療機関管理システム（正規化済み）
- **設計方針**: 正規化、直観的な構造、保守性の向上

## 新旧構造対比サマリー

### 旧構造の問題点
1. **巨大テーブル問題**: `main`テーブルに100以上のフィールドが混在
2. **非正規化**: 診療科をフラグで管理、住所情報の重複
3. **可読性の低さ**: `med_1`～`med_164`など意味不明なフィールド名
4. **保守性の悪さ**: 新しい診療科や診療内容の追加が困難

### 新構造の改善点
1. **関心の分離**: 論理的に関連するデータを別テーブルに分割
2. **正規化**: 重複データの排除、外部キー制約の活用
3. **直観的命名**: 分かりやすいテーブル名、フィールド名の採用
4. **拡張性**: 新データの追加が容易な設計

## 新テーブル構造一覧

### 1. 医療機関基本情報系

#### `hospitals` テーブル（医療機関基本情報）
医療機関の基本情報を格納するメインテーブル

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| hospital_id | varchar(10) | PRIMARY KEY | 医療機関コード |
| hospital_name | varchar(100) | NOT NULL | 医療機関名 |
| hospital_type_id | int(11) | FOREIGN KEY | 病院区分ID |
| status | enum('active','closed') | DEFAULT 'active' | 運営状況 |
| notes | text | NULL | 備考（基本情報） |
| created_at | timestamp | DEFAULT CURRENT_TIMESTAMP | 作成日時 |
| updated_at | timestamp | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新日時 |

**旧テーブルマッピング（main→hospitals）:**
- `hos_cd` → `hospital_id`
- `hos_name` → `hospital_name`
- `hos_div` → `hospital_type_id`（マスタテーブル参照に変更）
- `op_flg` → `status`（0=active, 1=closed）
- `clo_day` → `closure_date`
- `note` → `notes`

#### `hospital_types` テーブル（病院区分マスタ）
病院の種別を管理するマスタテーブル
(病院、特定機能病院、など)

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| type_id | int(11) | PRIMARY KEY AUTO_INCREMENT | 病院区分ID |
| type_code | varchar(5) | UNIQUE NOT NULL | 区分コード |
| type_name | varchar(50) | NOT NULL | 区分名 |
| description | text | NULL | 説明 |

**旧テーブルマッピング:**
- 旧`main.hos_div`の値をマスタ化

#### `addresses` テーブル（住所情報）
医療機関の住所情報を管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| address_id | int(11) | PRIMARY KEY AUTO_INCREMENT | 住所ID |
| hospital_id | varchar(10) | FOREIGN KEY | 医療機関コード |
| postal_code | varchar(7) | NULL | 郵便番号 |
| prefecture | varchar(10) | NULL | 都道府県 |
| area_name | varchar(40) | NULL | 地域名 |
| city | varchar(40) | NULL | 市 |
| ward | varchar(40) | NULL | 区 |
| town | varchar(40) | NULL | 町 |
| street_number | varchar(200) | NULL | 番地 |
| full_address | varchar(400) | NULL | 完全住所 |
| area_code | int(11) | FOREIGN KEY | 地区コード（areaテーブル参照） |

**旧テーブルマッピング（main→addresses）:**
- `hos_cd` → `hospital_id`
- `zipcode` → `postal_code`
- `pre` → `prefecture`
- `area` → `area_name`
- `city` → `city`
- `zone` → `ward`
- `town` → `town`
- `str_num` → `street_number`
- `ad` → `full_address`
- `are_cd` → `area_code`

#### `contact_details` テーブル（連絡先情報）
医療機関の連絡先情報を管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| contact_id | int(11) | PRIMARY KEY AUTO_INCREMENT | 連絡先ID |
| hospital_id | varchar(10) | FOREIGN KEY | 医療機関コード |
| phone | varchar(20) | NULL | 電話番号 |
| fax | varchar(20) | NULL | FAX番号 |
| email | varchar(254) | NULL | メールアドレス |
| website | varchar(500) | NULL | ウェブサイト |
| contact_type | enum('main','emergency','office') | DEFAULT 'main' | 連絡先種別 |

### 2. 人員情報系

#### `hospital_staff` テーブル（病院スタッフ情報）
理事長、病院長などの重要人物情報を管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| staff_id | int(11) | PRIMARY KEY AUTO_INCREMENT | スタッフID |
| hospital_id | varchar(10) | FOREIGN KEY | 医療機関コード |
| role_type | enum('chairman','director','vice_director','other') | NOT NULL | 役職種別 |
| name | varchar(60) | NOT NULL | 氏名 |
| specialty | varchar(50) | NULL | 専門分野 |
| graduation_year | year(4) | NULL | 卒業年度 |
| alma_mater | varchar(100) | NULL | 出身校 |
| association_id | varchar(20) | NULL | 医師会地域コード |
| notes | text | NULL | 備考 |

**旧テーブルマッピング（main→hospital_staff）:**
理事長情報:
- `hos_cd` → `hospital_id`
- `'chairman'` → `role_type`
- `chi_name` → `name`
- `chi_spe` → `specialty`
- `chi_year` → `graduation_year`
- `chi_sch` → `alma_mater`
- `chi_note` → `notes`

病院長情報:
- `hos_cd` → `hospital_id`
- `'director'` → `role_type`
- `pre_name` → `name`
- `pre_spe` → `specialty`
- `pre_year` → `graduation_year`
- `pre_sch` → `alma_mater`
- `pre_note` → `notes`

#### `medical_association` テーブル（医師会情報マスタ）
医師会についての情報を管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| section_id | int(11) | PRIMARY KEY AUTO_INCREMENT | 区分コード |
| area_id | varchar(20) | FOREIGN KEY | 地域コード |
| med_area | varchar(60) | NOT NULL | 二次医療圏 |
| med_association | varchar(60) | NOT NULL | 医師会名 |

### 3. 診療時間系

#### `consultation_hours` テーブル（診療時間）
医療機関の診療時間を管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| schedule_id | int(11) | PRIMARY KEY AUTO_INCREMENT | スケジュールID |
| hospital_id | varchar(10) | FOREIGN KEY | 医療機関コード |
| day_of_week | enum('monday','tuesday','wednesday','thursday','friday','saturday','sunday','holiday') | NOT NULL | 曜日 |
| period | enum('AM','PM','AM_PM') | NOT NULL | 時間帯 |
| is_available | boolean | DEFAULT false | 診療可否 |
| start_time | time | NULL | 開始時間 |
| end_time | time | NULL | 終了時間 |
| notes | varchar(200) | NULL | 備考 |

**旧テーブルマッピング（main→consultation_hours）:**
各曜日・時間帯の組み合わせ:
- `hos_cd` → `hospital_id`
- `mon_am` → `day_of_week='monday', period='morning', is_available`
- `mon_pm` → `day_of_week='monday', period='afternoon', is_available`
- `tue_am` → `day_of_week='tuesday', period='morning', is_available`
- （以下、全曜日・時間帯の組み合わせ）
- `con_hour` → `notes`

### 4. 診療科系

#### `medical_departments` テーブル（診療科マスタ）
診療科の分類と詳細を管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| department_id | int(11) | PRIMARY KEY AUTO_INCREMENT | 診療科ID |
| department_code | varchar(10) | UNIQUE NOT NULL | 診療科コード |
| department_name | varchar(100) | NOT NULL | 診療科名 |
| category_id | int(11) | FOREIGN KEY | 診療科カテゴリID |
| display_order | int(11) | DEFAULT 0 | 表示順序 |
| is_active | boolean | DEFAULT true | 有効フラグ |

#### `medical_categories` テーブル（診療科カテゴリ）
診療科の大分類を管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| category_id | int(11) | PRIMARY KEY AUTO_INCREMENT | カテゴリID |
| category_code | varchar(10) | UNIQUE NOT NULL | カテゴリコード |
| category_name | varchar(50) | NOT NULL | カテゴリ名 |
| display_order | int(11) | DEFAULT 0 | 表示順序 |

**旧テーブルマッピング（main→medical_categories + medical_departments）:**
大分類フラグから正規化:
- `int_med` → category `internal_medicine`
**`_med`系(大分類)**
内科系
小児科系
外科系
整形外科系
眼科系
耳鼻咽喉科系
皮膚科・泌尿器科系
産婦人科系
精神科系
歯科系
その他

- `ped_med` → category `pediatrics`
- `sur_med` → category `surgery`
- （各詳細診療科フラグは medical_departments テーブルに移行）

#### `hospital_departments` テーブル（病院診療科関連）
医療機関が対応している診療科を管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| relation_id | int(11) | PRIMARY KEY AUTO_INCREMENT | 関連ID |
| hospital_id | varchar(10) | FOREIGN KEY | 医療機関コード |
| department_id | int(11) | FOREIGN KEY | 診療科ID |
| is_primary | boolean | DEFAULT false | 主要診療科フラグ |
| notes | text | NULL | 診療科別備考 |
| created_at | timestamp | DEFAULT CURRENT_TIMESTAMP | 作成日時 |

**旧テーブルマッピング（main各診療科フラグ→hospital_departments）:**
各診療科フラグ（値が1の場合）をレコードとして正規化:
- `hos_cd` → `hospital_id`
- 各診療科フラグ → `department_id`（マスタ参照）

### 5. 診療内容系

#### `medical_services` テーブル（診療内容マスタ）
提供可能な医療サービスを管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| service_id | varchar(20) | PRIMARY KEY AUTO_INCREMENT | 診療内容ID |
| service_code | varchar(10) | UNIQUE NOT NULL | 診療内容コード |
| service_division | varchar(100) | NULL | 診療区分 |
| service_category | varchar(100) | NULL | 診療部門 |
| service_name | varchar(300) | NOT NULL | 診療内容名 |

**旧テーブルマッピング（medcare_mst→medical_services）:**
- `med_code` → `service_code`
- `med_det` → `service_name`
- `med_dep` → `service_category`
- `med_div` → `service_division`

#### `hospital_services` テーブル（病院診療内容関連）
医療機関が提供している診療内容を管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| hospital_id | varchar(10) | PRIMARY KEY(複合主キー) | 医療機関コード |
| service_id | varchar(20) | PRIMARY KEY(複合主キー) | 診療内容ID |
| notes | text | NULL | 個別備考 |
| created_at | timestamp | DEFAULT CURRENT_TIMESTAMP | 作成日時 |

**旧テーブルマッピング（medcare→hospital_services）:**
- `hos_cd` → `hospital_id`
- `med_1`～`med_164` → 各値が1以上の場合、`service_id`として正規化
- 各フィールドの値 → `availability_level`
- `med_note` → `notes`

### 6. 地域・エリア系

#### `areas` テーブル（地域情報）
地域マスタ情報（旧areaテーブルの改良版）

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| area_id | int(11) | PRIMARY KEY AUTO_INCREMENT | 地域ID |
| area_code | int(11) | UNIQUE NOT NULL | 地区コード |
| secondary_medical_area_code | int(11) | NULL | 二次医療圏コード |
| secondary_medical_area_name | varchar(50) | NULL | 二次医療圏名 |
| search_area_name | varchar(50) | NULL | 検索用地域名 |
| display_area_name | varchar(50) | NULL | 表示用地域名 |
| city | varchar(30) | NULL | 市 |
| ward | varchar(20) | NULL | 区 |
| town | varchar(30) | NULL | 町 |

### 7. 外部連携系

#### `carna_connect` テーブル（カルナコネクト情報）
カルナコネクトと連携しているかどうかを管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| hospital_code | varchar(10) | PRIMARY KEY | 医療機関コード |
| is_deleted | boolean | DEFAULT false | 削除フラグ |

### 8. 履歴・ログ系

#### `audit_logs` テーブル（監査ログ）
データ変更の監査ログを統合管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| log_id | bigint(20) | PRIMARY KEY AUTO_INCREMENT | ログID |
| table_name | varchar(50) | NOT NULL | 対象テーブル名 |
| record_id | varchar(50) | NOT NULL | 対象レコードID |
| action_type | enum('INSERT','UPDATE','DELETE') | NOT NULL | 操作種別 |
| old_values | json | NULL | 変更前データ |
| new_values | json | NULL | 変更後データ |
| user_id | varchar(10) | NULL | 操作者ID |
| user_name | varchar(50) | NULL | 操作者氏名 |
| user_facility | varchar(30) | NULL | 操作者施設 |
| user_department | varchar(30) | NULL | 操作者所属 |
| is_admin | boolean | DEFAULT false | 管理者フラグ |
| created_at | timestamp | DEFAULT CURRENT_TIMESTAMP | 操作日時 |
| ip_address | varchar(45) | NULL | IPアドレス |
| user_agent | text | NULL | ユーザーエージェント |

**旧テーブルマッピング（delete_log + insert_log→audit_logs）:**
- `hos_cd` → `record_id`
- `hos_name` → old_values内に格納
- `'DELETE'/'INSERT'` → `action_type`
- `log_data` → `created_at`
- `user_name` → `user_name`
- `user_id` → `user_id`
- `ins` → `user_facility`
- `bel` → `user_department`
- `adm_user` → `is_admin`

### 9. 問い合わせ・コミュニケーション系

#### `inquiries` テーブル（問い合わせ管理）
医療機関との問い合わせを統合管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| inquiry_id | int(11) | PRIMARY KEY AUTO_INCREMENT | 問い合わせID |
| hospital_id | varchar(10) | FOREIGN KEY | 医療機関コード |
| inquiry_type | enum('contact','visit','online','phone','other') | NOT NULL | 問い合わせ種別 |
| inquiry_date | date | NOT NULL | 問い合わせ日 |
| fiscal_year | year(4) | NOT NULL | 年度 |
| facility_type | enum('affiliated_hospital','medical_center') | NOT NULL | 施設区分 |
| external_contact_dept | varchar(50) | NULL | 連携機関対応者部署 |
| external_contact_position | varchar(50) | NULL | 連携機関対応者役職 |
| external_contact_name | varchar(50) | NULL | 連携機関対応者氏名 |
| external_participants | text | NULL | 連携機関参加者 |
| internal_contact_dept | varchar(50) | NULL | 当院対応者所属 |
| internal_contact_name | varchar(50) | NULL | 当院対応者氏名 |
| internal_participants | text | NULL | 当院参加者 |
| content_summary | text | NULL | 内容要約 |
| detailed_notes | text | NULL | 詳細備考 |
| data_created_dept | varchar(50) | NULL | データ作成部署 |
| status | enum('open','in_progress','closed') | DEFAULT 'open' | ステータス |

**旧テーブルマッピング（contact→inquiries）:**
- `con_cd` → `inquiry_id`
- `hos_cd` → `hospital_id`
- `date` → `inquiry_date`
- `year` → `fiscal_year`
- `ins` → `facility_type`
- `method` → `inquiry_type`
- `ex_dept` → `external_contact_dept`
- `ex_position` → `external_contact_position`
- `ex_name` → `external_contact_name`
- `ex_subnames` → `external_participants`
- `in_dept` → `internal_contact_dept`
- `in_name` → `internal_contact_name`
- `in_subnames` → `internal_participants`
- `detail` → `content_summary`
- `con_note` → `detailed_notes`
- `data_dept` → `data_created_dept`

### 10. システム管理系

#### `users` テーブル（システム利用ユーザー）
システム利用者の情報を管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| id | int(11) | PRIMARY KEY AUTO_INCREMENT | ID |
| user_id | varchar(10) | PRIMARY KEY | ユーザーID |
| username | varchar(50) | NOT NULL | ユーザー名 |
| password_hash | varchar(255) | NOT NULL | パスワードハッシュ |
| facility | varchar(30) | NULL | 所属施設 |
| department | varchar(30) | NULL | 所属部署 |
| role | enum('admin','editor','viewer') | DEFAULT 'viewer' | 権限レベル |
| is_active | boolean | DEFAULT true | アカウント有効フラグ |
| last_login_at | timestamp | NULL | 最終ログイン日時 |
| created_at | timestamp | DEFAULT CURRENT_TIMESTAMP | 作成日時 |
| updated_at | timestamp | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新日時 |

**旧テーブルマッピング（user→system_users）:**
- `user_id` → `user_id`
- `user_name` → `display_name`
- `ins` → `facility`
- `bel` → `department`
- `pw` → `password_hash`
- `adm_user` → `is_admin`
- `edi_user` → `can_edit`
- `start` → `account_start_date`
- `end` → `account_end_date`

#### `kawasaki_university_facility_id` テーブル（マスタ）
川崎学園の病院情報を管理
(附属病院、総合医療センター、高齢者医療センター)

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| facility_id | varchar(20) | PRIMARY KEY | 所属施設ID |
| name | varchar(50) | NOT NULL | 施設名 |
| fomal_name | varchar(60) | NOT NULL | 正式名称 |
| abbreviation | varchar(50) | NOT NULL | 略称 |

#### `kawasaki_university_department` テーブル（マスタ）
川崎学園の部署情報を管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| department_id | varchar(20) | PRIMARY KEY | 部署ID |
| name | varchar(50) | NOT NULL | 部署名 |

### 11. その他統合テーブル

#### `documents` テーブル（ドキュメント管理）
システム関連ドキュメントを統合管理

| フィールド名 | データ型 | 制約 | 説明 |
|-------------|----------|------|------|
| document_id | int(11) | PRIMARY KEY AUTO_INCREMENT | ドキュメントID |
| document_type | enum('message','maintenance','qa','manual','other') | NOT NULL | ドキュメント種別 |
| title | varchar(200) | NOT NULL | タイトル |
| content | text | NULL | 内容 |
| status | enum('draft','published','archived') | DEFAULT 'draft' | ステータス |
| priority | enum('low','normal','high','urgent') | DEFAULT 'normal' | 優先度 |
| target_facility | varchar(50) | NULL | 対象施設 |
| target_department | varchar(50) | NULL | 対象部署 |
| target_version | varchar(50) | NULL | 対象システムバージョン |
| published_date | date | NULL | 公開日 |
| effective_start_date | date | NULL | 有効開始日 |
| effective_end_date | date | NULL | 有効終了日 |
| author_user_id | varchar(10) | FOREIGN KEY | 作成者ID |
| is_visible | boolean | DEFAULT true | 表示フラグ |
| created_at | timestamp | DEFAULT CURRENT_TIMESTAMP | 作成日時 |
| updated_at | timestamp | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新日時 |

**旧テーブルマッピング（message + maintenance + q_a→documents）:**
messageテーブル:
- `id` → `document_id`
- `'message'` → `document_type`
- `comment` → `content`
- `req_date` → `published_date`
- `req_fac` → `target_facility`
- `req_dep` → `target_department`
- `version` → `target_version`
- `view` → `is_visible`

#### `intro` `invers_intro` テーブル（紹介データ）
医療機関間の紹介情報を管理

| フィールド名 | データ型 | 説明 |
|-------------|----------|------|
| hos_cd | varchar(10) | 医療機関コード（複合主キー） |
| ins | int(11) | 施設区分（複合主キー、0:附属病院, 1:総合医療センター） |
| year | year(4) | 年度（複合主キー） |
| date | date | 診療日（複合主キー） |
| fie_name | varchar(30) | 診療科（複合主キー） |
| fie_cd | int(11) | 診療科コード |
| intr | int(11) | 紹介件数 |

#### `training` テーブル（院外診療支援・研修情報）
院外診療支援・研修情報を管理

| フィールド名 | データ型 | 説明 |
|-------------|----------|------|
| hos_cd | varchar(10) | 医療機関コード（複合主キー） |
| year | year(4) | 年度（複合主キー） |
| ins | int(11) | 施設区分（複合主キー、0:附属病院, 1:総合医療センター） |
| tra_name | varchar(200) | 研修先医療機関名（複合主キー） |
| dep | varchar(60) | 診療科（複合主キー） |
| name | varchar(60) | 氏名（複合主キー） |
| start | date | 診療支援開始日（複合主キー） |
| end | date | 診療支援終了日（複合主キー） |
| date | varchar(300) | 日付 |
| dia_div | varchar(50) | 診療支援区分 |
| occ | varchar(30) | 職名 |

#### `contact` テーブル（コンタクト履歴）
医療機関同士のコンタクト履歴を保管

| フィールド名 | データ型 | 説明 |
|-------------|----------|------|
| hos_cd | varchar(10) | 医療機関コード（複合主キー） |
| hos_name | varchar(100) | 医療機関名 |
| year | year(4) | 年度（複合主キー） |
| ins | int(11) | 施設区分（0:附属病院, 1:総合医療センター）（複合主キー） |
| date | date | 日付（複合主キー） |
| method | varchar(50) | 方法（来院、訪問、オンライン等）（複合主キー） |
| ex_dept | varchar(50) | 連携機関対応者部署 |
| ex_position | varchar(50) | 連携機関対応者役職 |
| ex_name | varchar(10) | 連携機関対応者氏名（複合主キー） |
| ex_subnames | varchar(100) | 連携機関対応人数・氏名 |
| in_dept | varchar(50) | 当院対応者所属 |
| in_name | varchar(10) | 当院対応者氏名（複合主キー） |
| in_subnames | varchar(100) | 当院対応人数・氏名 |
| detail | varchar(100) | 内容 |
| con_note | varchar(100) | 備考 |
| data_dept | varchar(50) | データ作成部署 |

## 新構造の利点と改善点

### 1. 正規化による改善
- **巨大テーブルの分割**: mainテーブル（100+フィールド）を論理的に分離
- **重複データの排除**: 住所、連絡先、診療科情報などの適切な正規化
- **データ整合性の向上**: 外部キー制約による参照整合性の確保

### 2. 保守性の向上
- **直観的な命名**: テーブル名、フィールド名が内容を明確に表現
- **拡張性**: 新しい診療科、診療内容の追加が容易
- **型安全性**: enumや適切なデータ型による入力値の制限

### 3. クエリ性能の向上
- **適切なインデックス**: 主キー、外部キーによる検索性能の向上
- **結合の最適化**: 必要なデータのみを結合する設計
- **履歴管理**: JSON型を活用した効率的な監査ログ

### 4. セキュリティの強化
- **統合ログ管理**: 全ての操作を audit_logs で一元管理
- **ユーザー権限**: 細かい権限レベルの設定が可能
- **データ暗号化**: パスワードハッシュ化、機密情報の適切な管理

## 移行戦略

### フェーズ1: マスタデータ移行
1. `hospital_types` マスタの作成
2. `medical_categories` および `medical_departments` マスタの作成
3. `medical_services` マスタの作成（medcare_mstから）
4. `areas` テーブルの移行

### フェーズ2: 基本情報移行
1. `hospitals` テーブルへの基本情報移行
2. `addresses` テーブルへの住所情報分離
3. `contact_details` テーブルへの連絡先情報分離
4. `hospital_staff` テーブルへの人員情報移行

### フェーズ3: 関連情報移行
1. `hospital_departments` への診療科関連移行
2. `hospital_services` への診療内容関連移行
3. `consultation_hours` への診療時間移行
4. `external_connections` への外部連携情報移行

### フェーズ4: システム情報移行
1. `system_users` への利用者情報移行
2. `audit_logs` への履歴情報移行
3. `inquiries` への問い合わせ情報移行
4. `documents` への各種ドキュメント統合

## データ品質向上のポイント

### 1. 必須項目の明確化
- NOT NULL制約による必須データの確保
- DEFAULT値による初期値の設定
- CHECK制約による値の妥当性確認

### 2. 一意性の保証
- UNIQUE制約による重複データの防止
- 複合キーによる業務的一意性の確保

### 3. 参照整合性
- FOREIGN KEY制約による関連データの整合性
- ON DELETE/UPDATE の適切な設定

## 運用面での改善

### 1. バックアップ戦略
- 旧方式: 個別テーブルのバックアップテーブル
- 新方式: 統一された監査ログによる変更履歴管理

### 2. 検索性能
- 旧方式: 巨大テーブルでのフルスキャン
- 新方式: 適切なインデックスによる高速検索

### 3. データメンテナンス
- 旧方式: 複数テーブルの個別メンテナンス
- 新方式: 正規化されたマスタテーブルの一元管理

## 今後の拡張可能性

### 1. 新機能への対応
- 診療科の細分化・統合への柔軟な対応
- 新しい医療サービスの追加が容易
- 地域医療連携の拡大に対応

### 2. システム連携
- 外部システムとの連携情報の統一管理
- API連携のためのデータ構造の整備
- 他の医療システムとの互換性向上

### 3. 分析・レポート
- 正規化されたデータによる高度な分析が可能
- BI（Business Intelligence）ツールとの連携
- 統計レポートの自動生成

## 実装時の注意点

### 1. データ移行
- 旧データの品質チェック（NULL値、不正値の処理）
- 移行ツールによる自動変換とデータ検証
- 段階的移行による業務への影響最小化

### 2. アプリケーション改修
- PHP アプリケーションの大幅な修正が必要
- 新しいテーブル構造に対応したクエリの書き直し
- 既存機能の動作確認とテスト

### 3. パフォーマンステスト
- 新構造での性能検証
- インデックスの最適化
- クエリチューニング

この新しいデータベース構造により、現在の問題点が解決され、将来の拡張性と保守性が大幅に向上します。特に、正規化により管理が容易になり、データの整合性が保たれ、新しい要件への対応も柔軟に行えるようになります。


