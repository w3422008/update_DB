# データ移行仕様書
---

## 1. 病院区分マスタ（hospital_types）

- **移行先テーブル**: `hospital_types`
- **主キー**: `type_id`
- **移行元テーブル**: `main`
- **カラム対応表**:

| 移行先カラム         | 移行元カラム       | 備考 |
|----------------------|-------------------|------|
| type_id              | ---               | 主キー |
| type_name            | hos_div           | 区分名 |
| is_active            | ---               | デフォルト true |
| display_order        | ---               | 表示順序 |

---

## 2. 医療機関基本情報（hospitals）

- **移行先テーブル**: `hospitals`
- **主キー**: `hospital_id`
- **移行元テーブル**: `main`
- **カラム対応表**:

| 移行先カラム   | 移行元カラム   | 備考 |
|----------------|---------------|------|
| hospital_id    | hos_cd        | 医療機関コード |
| hospital_type_id | ---         | `hospital_types`とFK |
| hospital_name  | hos_name      | 医療機関名 |
| status         | op_flg        | `active/closed` 開院/閉院状態 |
| bed_count      | bed           | 許可病床数 |
| consultation_hour | con_hour   | 診療時間 |
| has_pt         | pt            | boolean変換 |
| has_ot         | ot            | boolean変換 |
| has_st         | st            | boolean変換 |
| notes          | note          | 備考 |
| closed_at      | clo_day       | 閉院日（元データはvarcharのため、date型に入れるには工夫が必要？） |
| created_at     | ---           | 移行時は現在日時可 |
| updated_at     | ---           | 移行時は現在日時可 |

---

## 3. 地域マスタ（areas）

- **移行先テーブル**: `areas`
- **主キー**: `area_id`
- **移行元テーブル**: `area`、`main`(カラム：`pre`)

| 移行先カラム   | 移行元カラム | 備考 |
|----------------|-------------|------|
| area_id     | sec_cd      | 地区コード |
| secondary_medical_area_name | area_name | 二次医療圏 |
| prefecture     | main/pre    | 都道府県 |
| city           | city        | 市 |
| ward           | zone        | 区 |
| town           | town        | 町 |
| is_active      | ---         | デフォルト true |
| display_order  | ---         | 表示順序 |

---

## 4. 住所情報（addresses）

- **移行先テーブル**: `addresses`
- **主キー**: `address_id`（AUTO_INCREMENT）
- **移行元テーブル**: `main`

| 移行先カラム | 移行元カラム | 備考 |
|--------------|-------------|------|
| hospital_id  | hos_cd     | FK:hospitals |
| area_id   | sec_cd     | FK:areas |
| postal_code  | zipcode   | 郵便番号 |
| street_number| str_num    | 番地 |
| full_address | ad         | 完全住所 |

---

## 5. 連絡先情報（contact_details）

- **移行先テーブル**: `contact_details`
- **主キー**: `contact_id`（AUTO_INCREMENT）
- **移行元テーブル**: `main`,`field_junction`

| 移行先カラム | 移行元カラム | 備考 |
|--------------|-------------|------|
| hospital_id  | hos_cd      | FK:hospitals |
| contact_detail | fie_name  | 部門名 |
| phone        | tel         | 電話番号 |
| fax          | fax         | FAX |
| email        | email       | メールアドレス |
| website      | ---         | Webサイト |
| note         | note        | 備考 |
| is_deleted   | delete_flg  | 削除フラグ |

---

## 6. 病棟種類マスタ（ward_types）

- **移行先テーブル**: `ward_types`
- **主キー**: `ward_id`
- **移行元テーブル**: `main`（病床関連カラムから推定）
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| ward_id | --- | 病床ID |
| ward_name | bed_reh,bed_tre,bed_main,bed_care,bed_tra,bed_att | 病床名 |
| is_active | --- | デフォルト true |
| display_order | --- | 表示順序 |

---

## 7. 医療機関-病棟種類関連（hospitals_ward_types）

- **移行先テーブル**: `hospitals_ward_types`
- **主キー**: 複合キー（hospital_id, ward_id）
- **移行元テーブル**: `main`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| hospital_id | hos_cd | FK:hospitals |
| ward_id | bed_reh, bed_tre等 | 病床種類から判定 |

---

## 8. 医療機関スタッフ（hospital_staffs）

- **移行先テーブル**: `hospital_staffs`
- **主キー**: `staff_id`（AUTO_INCREMENT）
- **移行元テーブル**: `main`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| hospital_id | hos_cd | FK:hospitals |
| role_type | ---（理事長、院長カラム） | 'chairman'/'director' |
| staff_name | chi_name, pre_name | 理事長・院長名 |
| specialty | chi_spe, pre_spe | 専門分野 |
| graduation_year | chi_year, pre_year | 卒業年度 |
| alma_mater | chi_sch, pre_sch | 出身校 |
| notes | chi_note, pre_note | 備考 |

---

## 9. 診療時間（consultation_hours）

- **移行先テーブル**: `consultation_hours`
- **主キー**: 複合キー（hospital_id, day_of_week, period）
- **移行元テーブル**: `main`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| hospital_id | hos_cd | FK:hospitals |
| day_of_week | --- | 'monday'〜'sunday' |
| period | --- | 'AM'/'PM' |
| is_available | mon_am, mon_pm等 | boolean変換 |

---

## 10. 診療科マスタ（medical_departments）

- **移行先テーブル**: `medical_departments`
- **主キー**: `department_id`
- **移行元テーブル**: `department`, `main`の診療科カラム
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| department_id | dep_cd | 診療科コード |
| category | sec_name | カテゴリ名 |
| department_name | dep_name | 診療科名 |
| is_active | --- | デフォルト true |
| display_order | --- | 表示順序 |

---

## 11. 医療機関-診療科関連（hospital_departments）

- **移行先テーブル**: `hospital_departments`
- **主キー**: 複合キー（hospital_id, department_id）
- **移行元テーブル**: `main`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| hospital_id | hos_cd | FK:hospitals |
| department_id | --- | 診療科フラグから判定 |

*備考: mainテーブルのint_med, ped_med等の診療科フラグから対応する診療科を判定*

---

## 12. 医療サービスマスタ（medical_services）

- **移行先テーブル**: `medical_services`
- **主キー**: 複合キー（service_id, service_division）
- **移行元テーブル**: `medcare_mst`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| service_id | --- | 診療内容コード |
| service_division | med_div | 診療区分 |
| service_category | med_dep | 診療部門 |
| service_name | med_det | 診療内容名 |
| is_active | delete_flg | デフォルト true |
| display_order | med_code | 表示順序 |

---

## 13. 医療機関-サービス関連（hospital_services）

- **移行先テーブル**: `hospital_services`
- **主キー**: 複合キー（hospital_id, service_id）
- **移行元テーブル**: `medcare`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| hospital_id | hos_cd | FK:hospitals |
| service_id | --- | med_1〜med_164から判定 |
| notes | med_note | 個別備考 |

*備考: med_1〜med_164の値が1の場合、対応するサービスを提供*

---

## 14. 連携パスマスタ（clinical_pathways）

- **移行先テーブル**: `clinical_pathways`
- **主キー**: `clinical_pathway_id`
- **移行元テーブル**: `c_path`のカラム定義から
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| clinical_pathway_id | --- | 'CP001'〜'CP009' |
| path_name | --- | パス名（脳卒中パス等） |
| is_active | delete_flg | デフォルト true |
| display_order | --- | AUTO_INCREMENT |

---

## 15. 医療機関-連携パス関連（clinical_pathway_hospitals）

- **移行先テーブル**: `clinical_pathway_hospitals`
- **主キー**: 複合キー（hospital_id, clinical_pathway_id, user_facility_id）
- **移行元テーブル**: `c_path`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| hospital_id | hos_cd | FK:hospitals |
| clinical_pathway_id | --- | cp0〜cp8から判定 |
| user_facility_id | ins | 登録者所属施設ID（0:附属 1:総合） |

*備考: cp0〜cp8の値が1の場合、対応するパスを実施*

---

## 16. カルナコネクト（carna_connects）

- **移行先テーブル**: `carna_connects`
- **主キー**: `hospital_id`
- **移行元テーブル**: `carna_connect`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| hospital_id | hos_cd | FK:hospitals |
| is_deleted | delete_flg | boolean変換 |

---

## 17. 川崎学園施設マスタ（kawasaki_university_facilities）

- **移行先テーブル**: `kawasaki_university_facilities`
- **主キー**: `facility_id`
- **移行元テーブル**: 固定マスタ（新規作成）
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| facility_id | --- | 固定値設定 |
| facility_name | --- | 固定値設定 |
| formal_name | --- | 固定値設定 |
| abbreviation | --- | 固定値設定 |
| is_active | --- | デフォルト true |
| display_order | --- | 表示順序 |

---

## 18. 川崎学園部署マスタ（kawasaki_university_departments）

- **移行先テーブル**: `kawasaki_university_departments`
- **主キー**: `department_id`
- **移行元テーブル**: 固定マスタ（新規作成）
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| department_id | --- | 固定値設定 |
| department_name | --- | 固定値設定 |
| is_active | --- | デフォルト true |
| display_order | --- | 表示順序 |

---

## 19. ユーザー（users）

- **移行先テーブル**: `users`
- **主キー**: `user_id`
- **移行元テーブル**: `user`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| user_id | user_id | ユーザーID |
| user_name | user_name | ユーザー名 |
| password_hash | pw | ハッシュ化必要 |
| facility_id | ins | 施設ID変換 |
| department_id | bel | 部署ID変換 |
| role | adm_user, edi_user | 権限レベル判定 |
| is_active | onf | boolean変換 |
| last_login_at | --- | 最終ログイン日時 |
| created_at | start | 現在日時 |
| updated_at | up_date,end | 更新日時変換 |

---

## 20. 統合ログ（unified_logs）

- **移行先テーブル**: `unified_logs`
- **主キー**: `log_id`（AUTO_INCREMENT）
- **移行元テーブル**: `delete_log`, `insert_log`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| log_type | --- | 'audit' |
| user_id | user_id | ユーザーID |
| table_name | --- | 対象テーブル名 |
| record_id | hos_cd | レコードID |
| action_type | --- | 'INSERT'/'DELETE' |
| description | log_data | ログデータ |
| ip_address | --- | NULL |
| created_at | --- | 現在日時 |

---

## 21. 紹介・逆紹介（introductions）

- **移行先テーブル**: `introductions`
- **主キー**: `hospital_id`,`user_facility_id`,`year`,`date`,`department_name`,`intro_type`
- **移行元テーブル**: `intro`, `invers_intro`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| hospital_id | hos_cd | 医療機関コード |
| user_facility_id | ins | 登録者所属施設ID（0:附属 1:総合） |
| intro_type | --- | 'intro'/'inverse_intro' |
| year | year | 年度 |
| date | date | 診療日 |
| department_name | fie_name | 診療科名 |
| department_id | fie_cd | 診療科コード |
| intro_count | intr, invr_intr | 件数 |

---

## 22. 職名マスタ（positions）

- **移行先テーブル**: `positions`
- **主キー**: `position_id`
- **移行元テーブル**:`training`のpositionから
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| position_id | --- | 新規ID生成 |
| position_name | position | 職名 |
| is_active | --- | デフォルト true |
| display_order | --- | 表示順序 |

---

## 23. 研修・兼業（training）

- **移行先テーブル**: `training`
- **主キー**: `hospital_id`,`year`,`user_facility_id`,`department`,`start_date`
- **移行元テーブル**: `training`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| hospital_id | hos_cd | 医療機関コード |
| user_facility_id | ins | 登録者所属施設ID（0:附属 1:総合） |
| year | year | 年度 |
| training_name | tra_name | 研修先医療機関名 |
| department | dep | 診療科 |
| staff_name | name | 氏名 |
| start_date | start | 開始日 |
| end_date | end | 終了日 |
| date | date | 日付 |
| diagnostic_aid | dia_div | 診療支援区分 |
| position | position | 職名 |
| position_id | --- | positions参照 |

---

## 24. コンタクト履歴（contacts）

- **移行先テーブル**: `contacts`
- **主キー**: `hospital_id`,`year`,`user_facility_id`,`date`,`method`
- **移行元テーブル**: `contact`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| hospital_id | hos_cd | 医療機関コード |
| user_facility_id | ins | 登録者所属施設ID（0:附属 1:総合） |
| year | year | 年度 |
| date | date | 日付 |
| method | method | 方法 |
| external_department | ex_dept | 連携機関対応者部署 |
| external_position | ex_position | 連携機関対応者役職 |
| external_contact_name | ex_name | 連携機関対応者氏名 |
| external_additional_participants | ex_subnames | 連携機関対応人数・氏名 |
| internal_department | in_dept | 当院対応者所属 |
| internal_contact_name | in_name | 当院対応者氏名 |
| internal_additional_participants | in_subnames | 当院対応人数・氏名 |
| detail | detail | 内容 |
| notes | con_note | 備考 |
| data_department | data_dept | データ部署 |

---

## 25. 問い合わせ（inquires）

- **移行先テーブル**: `inquires`
- **主キー**: `inquire_id`（AUTO_INCREMENT）
- **移行元テーブル**: `q_a`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| user_id | r_staff_num | 問い合わせ者 |
| priority | emerg | 'general'/'urgent' |
| status | supp_status | ステータス変換 |
| description | content | 問い合わせ内容 |
| assigned_to | a_staff_num | 担当者 |
| resolution | answer | 解決方法・回答 |
| created_at | order_date | 問い合わせ日時 |
| updated_at | --- | 最終更新日時 |
| resolved_at | ans_date | 解決日時 |

*備考: trash_flgが1のデータは移行対象外*

---

## 26. メンテナンス通知（maintenances）

- **移行先テーブル**: `maintenances`
- **主キー**: `maintenance_id`（AUTO_INCREMENT）
- **移行元テーブル**: `maintenance`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| title | title | タイトル |
| comment | comment | 実施内容 |
| date | date | 予定作業日 |
| start_time | start_time | 予定開始時刻 |
| end_time | end_time | 予定終了時刻 |
| view | view | 表示フラグ |
| created_by | --- | デフォルトユーザー設定 |
| created_at | upload_date | 作成日時 |

---

## 27. メンテナンス実行中通知（maintenance_start）

- **移行先テーブル**: `maintenance_start`
- **主キー**: `id`（AUTO_INCREMENT）
- **移行元テーブル**: `maintenance_start`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| maintenance_id | --- | maintenanceテーブルとリンク |
| title | title | 通知タイトル |
| description | comment | 通知詳細 |
| implementation_details | comment2 | 実施内容 |
| view | view | 表示フラグ |
| created_by | --- | デフォルトユーザー設定 |

---

## 28. システムバージョン管理（system_versions）

- **移行先テーブル**: `system_versions`
- **主キー**: `version_id`（AUTO_INCREMENT）
- **移行元テーブル**: 新規作成,`message`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| version_number | view | バージョン番号 |
| release_date | --- | 登録日 |
| is_current | --- | 最新版のみtrue |
| release_notes | comment | 修正内容 |

---

## 29. メッセージ・要望管理（messages）

- **移行先テーブル**: `messages`
- **主キー**: `message_id`（AUTO_INCREMENT）
- **移行元テーブル**: `message`
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| status | --- | ステータス変換(データ移行時は「」で固定) |
| comment | comment | 内容 |
| view | view | 表示フラグ |
| version_id | --- | バージョンとリンク |
| assigned_to | --- | 作成者（ユーザーIDを登録し、紐づいている所属を取得） |
| res_date | res_date | 対応日 |
| created_at | req_date | 作成日時 |

---

## 30. システム状態管理（system_status）

- **移行先テーブル**: `system_status`
- **主キー**: `status_id`（AUTO_INCREMENT）
- **移行元テーブル**: 新規作成
- **カラム対応表**:

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| system_mode | --- | デフォルト'normal' |
| status_message | --- | NULL |
| maintenance_id | --- | NULL |
| changed_by | --- | デフォルトユーザー設定 |

---

## 31. 親族情報（relatives）

- **移行先テーブル**: `relatives`
- **主キー**: `rel_cd`
- **移行元テーブル**: `relative`
- **備考**: カラム名変更など

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| relative_id | rel_cd | 主キー |
| hospital_id | hos_cd | 医療機関コード |
| relative_name | name | 人物名 |
| connection | conn | 関係 |
| school_name | sch_name | 学校名 |
| entrance_year | ent_year | 入学年 |
| graduation_year | gra_year | 卒業年 |
| notes | note | 備考 |
| is_deleted | delete_flg | デフォルト false |

---

## 32. 医療連携懇話会参加年度（social_meetings）

- **移行先テーブル**: `social_meetings`
- **主キー**: 複合キー（hospital_id, user_facility_id, meeting_year）
- **移行元テーブル**: `social_meeting`
- **備考**: カラム名変更など

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| hospital_id | hos_cd | 医療機関コード |
| user_facility_id | ins | 登録者所属施設ID（0:附属 1:総合） |
| meeting_year | year | 参加年度 |
| is_deleted | delete_flg | デフォルト false |

---

## 33. 医療機関コード履歴（hospital_code_history）

- **移行先テーブル**: `hospital_code_history`
- **主キー**: `history_id`（AUTO_INCREMENT）
- **移行元テーブル**: なし（新規作成）

| 移行先カラム | 移行元カラム | 備考 |
|-------------|-------------|------|
| history_id | --- | 履歴ID |
| hospital_id | --- | 現在の医療機関コード |
| former_hospital_id | --- | 以前の医療機関コード |
| change_date | --- | コードが更新された日時 |
| created_at | --- | 登録日時 |

# 付録
- **移行ルール**
  - 日付・時刻カラムが存在しない場合は、移行時に`CURRENT_TIMESTAMP`を設定する。
  - booleanフラグは 0/1, Y/N を true/false に変換する。
  - 参照整合性（外部キー）は必ず移行順序を意識する（例：`hospital_types` → `hospitals` → `addresses`）。
  - 不要データ（閉院済み、無効フラグ）は事前に除外または変換する。
